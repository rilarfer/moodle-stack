
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://rilarfer.stack-moodle.com/Installation/Optimising_Maxima/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>Optimising Maxima - STACK</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#optimising-maxima" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="STACK" class="md-header__button md-logo" aria-label="STACK" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            STACK
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Optimising Maxima
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="STACK" class="md-nav__button md-logo" aria-label="STACK" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    STACK
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../About/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acerca de STACK
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../AbInitio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guía Autoría inicio rápido
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../AbInitio/Authoring_quick_start_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Una pregunta básica
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../AbInitio/Authoring_quick_start_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Variables de la pregunta
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../AbInitio/Authoring_quick_start_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Mejorando la retroalimentación
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../AbInitio/Authoring_quick_start_4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Aleatorización
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../AbInitio/Authoring_quick_start_5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 Test de Preguntas
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../AbInitio/Authoring_quick_start_6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 Preguntas matemáticas de varias partes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../AbInitio/Authoring_quick_start_7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 Desactivar la simplificación
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../AbInitio/Authoring_quick_start_8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8 Importación y cuestionarios
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../Authoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Autoría
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../CAS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CAS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instalación
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../Developer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Desarrolladores
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../Moodle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moodle
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../Reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Referencias
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../Students/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Estudiantes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../Topics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Temas
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#terminating-runaway-lisps" class="md-nav__link">
    Terminating runaway LISPS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compiled-lisp" class="md-nav__link">
    Compiled Lisp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-maxima-image" class="md-nav__link">
    Create Maxima Image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-maxima-image-by-hand" class="md-nav__link">
    Create Maxima Image by hand
  </a>
  
    <nav class="md-nav" aria-label="Create Maxima Image by hand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gcl" class="md-nav__link">
    GCL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clisp" class="md-nav__link">
    CLISP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sbcl" class="md-nav__link">
    SBCL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-lisps" class="md-nav__link">
    Other Lisps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-maxima-on-other-servers" class="md-nav__link">
    Putting Maxima on other servers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimisation-results" class="md-nav__link">
    Optimisation results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cas-on-linux" class="md-nav__link">
    CAS on Linux
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="optimising-maxima">Optimising Maxima</h1>
<p>There are several ways to reduce the access and execution time of this CAS which can prove useful for scaling. They have the potential to greatly speed up STACK, and are required on a production server.  It is particularly important on a Linux system to compile the Maxima code.</p>
<p>The instructions for both CLISP and SBCL have been tested and work in STACK 3.  As of November 2020, these are working with all versions between Maxima 5.36.1 and Maxima 5.44.0.</p>
<p>The procees of creating an optimised Maxima image is now automated.  This should be built automatically when installing STACK, and on upgrade.  However, you should use the plugin healthcheck script to confirm you have a fully working system.</p>
<p>For developers the code to automatically generate the LISP images is described below.</p>
<h2 id="terminating-runaway-lisps">Terminating runaway LISPS</h2>
<p>It is relatively easy for students to inadvertently generate an answer which takes Maxima a very long time to evaluate.  Typically this arises from where Maxima needs to expand out the brackets by comparing <code>(x-a)^59999</code> with a similar expression.  It is very hard to ensure this kind of calculation is impossible so in general this situation will arise from time to time.  The PHP scripts have a timeout, but on Linux systems you can also ensure the underlying LISP process is killed off using <code>timeout</code> command in Linux.  This is particularly valuable for production systems where stability is essential.</p>
<ol>
<li>Check that your Linux has the <code>timeout</code> command.  Because this is not standard we have not included this mechanism by default.</li>
<li>Make sure STACK is working.</li>
<li>Set the CAS connection timeout variable as normal in the STACK settings.  E.g. you might choose 5 seconds</li>
<li>
<p>Use the following Maxima command</p>
<p>timeout --kill-after=6s 6s maxima</p>
</li>
</ol>
<p>It is important that the timeout time is <em>longer</em> than the CAS connection timeout.  That way, PHP gives up first and degrades gracefully.  The OS then kills the process later.  If you choose the timeout to be the same or less, PHP may not have gathered enough data to degrade gracefully.  </p>
<p>The above can be used with either a direct Maxima connection, or with the image created as described below.</p>
<h2 id="compiled-lisp">Compiled Lisp</h2>
<p><a href="../../CAS/Maxima/">Maxima</a> can be run with a number of different <a href="http://maxima.sourceforge.net/lisp.html">Lisp implementations</a>.
Although CLISP is the most portable - due to being interpreted - other Lisps can give faster execution.</p>
<h2 id="create-maxima-image">Create Maxima Image</h2>
<p>Lisp is able to save a snapshot of its current state to a file. This file can then be used to restart Lisp, and hence Maxima, in exactly that state. This optimization involves creating a snapshot of Lisp with Maxima and all the STACK code loaded, which can speed up launch times by an order of magnitude on Linux. This tip was originally provided Niels Walet.</p>
<p>The principle is to save an image of Maxima running with STACK libraries already loaded then run this directly.  The healthcheck page contains a link at the bottom "Create Maxima Image".  We strongly recommend you use the automated option to create a Maxima image.</p>
<h2 id="create-maxima-image-by-hand">Create Maxima Image by hand</h2>
<p>These steps should not be needed.  Our goal is to do this automatically.  If your OS and Maxima version do not work, please contact the developers with details and we will try to automate this process.</p>
<p>For reference:</p>
<ul>
<li>Check your Maxima Lisp with <code>maxima --list-avail</code> to see what versions of Maxima and which Lisp you have.  This information is available through the healthcheck page.</li>
<li>Load Maxima, using switches for the particular version you want, e.g. <code>maxima -l CLISP -u 5.19.2</code> or <code>maxima --use-version=5.40.1</code>.</li>
</ul>
<h3 id="gcl">GCL</h3>
<p>This is the default Lisp used by most of the binary distributions, and therefore the Lisp which you are most likely to have.</p>
<ul>
<li>Get STACK working with Platform type set to 'Linux'. Run the health-check. It is important to do this every time you upgrade your version.</li>
</ul>
<pre><code>    load(&quot;&lt;path&gt;/maximalocal.mac&quot;);
    :lisp (si::save-system &quot;/path/to/moodledata/stack/maxima-optimised&quot;)  
    quit();
</code></pre>
<ul>
<li>Go into the STACK settings and set Platform type to 'Linux (Optimised)'.</li>
<li>Set Maxima command to.</li>
</ul>
<pre><code>    /path/to/moodledata/stack/maxima-optimised  -eval '(cl-user::run)'
</code></pre>
<h3 id="clisp">CLISP</h3>
<p><a href="http://clisp.cons.org/impnotes/image.html">Save an image in CLISP</a>.</p>
<ul>
<li>Get STACK working with Platform type set to 'Linux'. Run the health-check. It is important to do this every time you upgrade your version.</li>
<li>We assume you have CLISP. Type <strong>locate lisp.run</strong> to find the path(s) for the next step. You might need to run the command as root, and if you get no results try doing a <strong>sudo updatedb</strong>.</li>
<li>Within Maxima, type the following lines to create an image and exit.</li>
</ul>
<pre><code>    load(&quot;&lt;path&gt;/maximalocal.mac&quot;);
    load(&quot;&lt;path&gt;/stackmaxima.mac&quot;);
    :lisp (ext:saveinitmem &quot;/path/to/moodledata/stack/maxima-optimised.mem&quot; :init-function #'user::run)
    quit();
</code></pre>
<ul>
<li>Go into the STACK settings and set Platform type to 'Linux (Optimised)'.</li>
<li>Set Maxima command to.</li>
</ul>
<pre><code>    &lt;path&gt;/lisp.run -q -M &lt;path&gt;/maxima-optimised.mem
</code></pre>
<ul>
<li>Click Save changes at the bottom of the settings page.</li>
<li>Visit the healthcheck page, and clear the cache (if applicable), to make sure everything is still working.</li>
</ul>
<p>Access speed increases of between 2 and 9.5 times have been reported over the standard CLISP configurations.</p>
<h3 id="sbcl">SBCL</h3>
<p>If you are using STACK with SBCL (if you are using CentOS/SL5/RHEL with Maxima from EPEL),
use the following to generate a standalone executable:</p>
<ul>
<li>Get STACK working with Platform type set to 'Linux'. Run the healthcheck. It is important to do this every time you upgrade your version.</li>
<li>Go into your moodledata/stack folder as the current directory, and run Maxima.</li>
<li>In Maxima, type the commands:</li>
</ul>
<pre><code>    load(&quot;maximalocal.mac&quot;);
    :lisp (sb-ext:save-lisp-and-die &quot;maxima-optimised&quot; :toplevel #'run :executable t)
</code></pre>
<ul>
<li>Go into the STACK settings and set the Platform to 'Linux (Optimised)'.</li>
<li>You should be able to leave Maxima command blank.</li>
<li>Click save changes at the bottom of the settings page.</li>
<li>Visit the healthcheck page, and clear the cache (if applicable), to make sure everything is still working.</li>
</ul>
<h3 id="other-lisps">Other Lisps</h3>
<p>The following web pages have more information for a few types of Lisp: <a href="http://stackoverflow.com/questions/25046/lisp-executable">http://stackoverflow.com/questions/25046/lisp-executable</a> and
<a href="http://code.google.com/p/lispbuilder/wiki/StandAloneExecutables#Defining_a_Startup_Function">http://code.google.com/p/lispbuilder/wiki/StandAloneExecutables#Defining_a_Startup_Function</a></p>
<h2 id="putting-maxima-on-other-servers">Putting Maxima on other servers</h2>
<p>Running Maxima on a separate server dedicated to the task is more secure. We believe it also
improves performance because the server can start up Maxima processes in advance
so they are all ready and waiting to compute some CAS with zero delay.</p>
<p>See a <a href="http://github.com/maths/stack_util_maximapool">Maxima pool</a> has been implemented to do this.  See <a href="https://github.com/maths/stack_util_maximapool/blob/master/README.md">https://github.com/maths/stack_util_maximapool/blob/master/README.md</a></p>
<h2 id="optimisation-results">Optimisation results</h2>
<p>The following data was gathered by CJS on 23/9/2012 using Maxima 5.28.0 with CLISP 2.49 (2010-07-07) on a Linux server.</p>
<p>Running the PHP testing suites we have the following data, where all times are in seconds. The second line, in italics, is time per test.</p>
<table>
  <tr>
    <th align="left">CAS setting</th>
    <th align="left">Answertest (460 tests)</th>
    <th align="left">Inputs (257 tests)</th>
  </tr>
  <tr>
    <td>Linux</td>
    <td>517.8672<br> <i>1.1258</i>  </td>
    <td>208.85655<br> <i>0.81267</i>  </td>
  </tr>
  <tr>
    <td>Mature cache <br>(with Linux)</td>
    <td>0.92644 <br> <i>0.00201</i> </td>
    <td>13.9798<br> <i>0.0544</i> </td>
  </tr>
  <tr>
    <td>Linux (optimised)</td>
    <td>95.16954<br> <i>0.20689</i>  </td>
    <td>20.89807<br> <i>0.08132</i>  </td>
  </tr>
  <tr>
    <td>Mature cache <br>(when optimised)</td>
    <td>0.90839 <br> <i>0.00197</i> </td>
    <td>1.48648<br> <i>0.00578</i> </td>
  </tr>
</table>

<p>However, not all tests result in a CAS call.  So, to estimate this we subtract the overhead time for a mature cache (which is essentially time for database/PHP processing) from the raw time and divide by the number of CAS calls.  We have the following time per CAS call estimates.</p>
<table>
<thead>
<tr>
<th>CAS setting</th>
<th>Answertest (438 calls)</th>
<th>Inputs (204 calls)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Linux</td>
<td>1.180</td>
<td>0.955</td>
</tr>
<tr>
<td>Linux (optimised)</td>
<td>0.215</td>
<td>0.095</td>
</tr>
</tbody>
</table>
<p>The optimised version saves a considerable amount of time, representing a significant performance improvement in the critical step of just under a second per call.  Well worth the effort (&amp; maintenance) to reward ratio.  It is likely that using a compiled version of LISP would result in further considerable savings.</p>
<p>However, it isn't entirely clear to me at this point why the input tests with a mature cache using the default Linux connection takes over 13 seconds.  This seems anomalous.</p>
<p>The following data was gathered by CJS on 10/10/2012 using Maxima 5.28.0 with CLISP 2.49 and SBCL 1.0.58-1.el6, both on the same Linux server.  The table gives time in seconds to run the answer tests (462 tests).</p>
<table>
<thead>
<tr>
<th>Maxima version</th>
<th>Linux</th>
<th>Linux optimised</th>
</tr>
</thead>
<tbody>
<tr>
<td>CLISP 2.49</td>
<td>652.3</td>
<td>117.76314</td>
</tr>
<tr>
<td>SBCL 1.0.58-1.el6</td>
<td>1570.6</td>
<td>118.39215</td>
</tr>
</tbody>
</table>
<p>With both lisp versions, the optimisation gives a significant performance gain and there is very little difference between the times of the optimised versions.</p>
<h2 id="cas-on-linux">CAS on Linux</h2>
<p>The tests above use Maxima through the PHP interface.  To gauge the overhead from the CAS itself we ran the following tests on the same server using Maxima 5.28.0 with CLISP 2.49.</p>
<pre><code>model name: Intel(R) Xeon(R) CPU, E3113  @ 3.00GHz
</code></pre>
<table>
<thead>
<tr>
<th>Linux</th>
<th>Time for 100 cycles (s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Start Maxima and quit</td>
<td>43</td>
</tr>
<tr>
<td>Start STACK  and quit</td>
<td>124</td>
</tr>
<tr>
<td>Process AtAlgEquiv</td>
<td>133</td>
</tr>
</tbody>
</table>
<p>Without optimising Linux, compared to processing one AtAlgEquiv, there is approximately 93% overhead in starting the maxima process.</p>
<table>
<thead>
<tr>
<th>Optimised Linux</th>
<th>Time for 100 cycles (s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Start STACK and quit</td>
<td>12</td>
</tr>
<tr>
<td>Process AtAlgEquiv</td>
<td>16</td>
</tr>
<tr>
<td>Process 100 AtAlgEquiv</td>
<td>104</td>
</tr>
<tr>
<td>Process 100 plot</td>
<td>117</td>
</tr>
</tbody>
</table>
<p>The PHP processing time is almost insignificant against the time it takes to initiate and use the CAS.</p>
<p>With the optimised Linux we have reduced the loading time, and the loading overhead considerably.  A single ATAlgEquiv request takes about 0.04s.  Asking for 100 ATAlgEquiv requests in a single session take 0.0092s per request.  Asking for 100 plot commands takes 1.05s per plot - which is rather slow (plots undertake a large number of floating point calculations).
The overhead times for loading Maxima might be reduced, and smoothed out by using the Maxima pool, see <a href="http://github.com/maths/stack_util_maximapool">http://github.com/maths/stack_util_maximapool</a> for an implementation of this.  The computation times are difficult to reduce.</p>
<p>Memory appears to be modest: the optimised Linux takes about 15Mb of memory per process.</p>
<h1 id="compiling-a-maxima-image">Compiling a Maxima image</h1>
<p>The following was tested in March 2016 on CENTOS.  It is for compiling a Maxima image.  Really this is mostly for developers.</p>
<pre><code>sudo yum install sbcl texinfo rpm-build
cd ~
wget http://dl.fedoraproject.org/pub/fedora/linux/updates/22/SRPMS/m/maxima-5.36.1-2.fc22.src.rpm
rpm -i maxima-5.36.1-2.fc22.src.rpm
cd rpmbuild
rpmbuild -ba SPECS/maxima.spec
cd RPMS/x86_64
sudo yum remove maxima
sudo yum install maxima-runtime-sbcl-5.36.1-2.el6.x86_64.rpm maxima-5.36.1-2.el6.x86_64.rpm
</code></pre>
<p>The following was tested in March 2016 on Ubuntu 14.04.4 LTS (GNU/Linux 3.13.0-79-generic x86_64) (Trusty). Install dependencies:</p>
<pre><code>sudo apt-get -y install clisp texinfo
</code></pre>
<p>Then run:</p>
<pre><code>cd ~
wget -O maxima_source.tar.gz http://sourceforge.net/projects/maxima/files/Maxima-source/5.36.1-source/maxima-5.36.1.tar.gz/download
tar zxvf maxima_source.tar.gz
cd maxima-5.36.1
./configure --with-clisp
make --silent
sudo make install --silent
maxima --list-avail
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <center> Copyright &copy; 2023 Ricardo Largaespada </center>
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/rilarfer" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../javascripts/removeCredits.js"></script>
      
    
  </body>
</html>