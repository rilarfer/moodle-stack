<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="http://rilarfer.stack-moodle.com/Developer/Local_Usage/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Local Usage - STACK</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Local Usage";
        var mkdocs_page_input_path = "Developer\\Local_Usage.md";
        var mkdocs_page_url = "/Developer/Local_Usage/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> STACK
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../AbInitio/">Guía Autoría inicio rápido</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../About/">About</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Authoring/">Autoría</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../CAS/">CAS</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../">Desarrollador</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Installation/">Instalación</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Moodle/">Moodle</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Reference/">Referencias</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Students/">Estudiantes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Topics/">Temas</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">STACK</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Local Usage</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="local-usage">Local Usage</h1>
<p>There are a number of <a href="../../Authoring/Reporting/">reporting options</a> which are built-in and supported.  To use the features on this page requires moodle admin permission.</p>
<p>It is often useful to know numbers about STACK usage on your local server.  To do this we need to work in the Moodle database.  E.g.</p>
<ol>
<li>How many STACK questions were initialised for students during the last time interval?</li>
<li>How many attempts those students made to those question during that time on average?</li>
<li>Which courses had most attempts and which courses had the most STACK questions in use?</li>
<li>Question bank status by course, how many questions were in use, which questions have not been used for a long time?</li>
<li>Quiz/activity usage, i.e. in what context are the questions being used and for example how many questions are present in a quiz by average?</li>
<li>Duplicate questions, how many copies of the same questions are present in the question banks?</li>
</ol>
<p>Do get this kind of data you will need the <a href="https://moodle.org/plugins/report_customsql">custom sql report</a>.</p>
<h3 id="the-number-of-questions-that-students-have-interacted-with">The number of questions that students have interacted with</h3>
<p>That is the number of questions that students have interacted with.</p>
<pre><code>SELECT COUNT(1)
FROM {question_attempts} qa
JOIN {question} q ON q.id = qa.questionid
JOIN {quiz_attempts} quiza ON quiza.uniqueid = qa.questionusageid
WHERE quiza.preview = 0
AND q.qtype = 'stack'
AND qa.timemodified BETWEEN %%STARTTIME%% AND %%ENDTIME%%
And, here is a query that does number of questions attempted (ever) by course

SELECT c.shortname AS Website, COUNT(1) AS Number_of_STACK_questions_attempted

FROM {question_attempts} qa
JOIN {question} q ON q.id = qa.questionid
JOIN {quiz_attempts} quiza ON quiza.uniqueid = qa.questionusageid
JOIN {quiz} quiz ON quiz.id = quiza.quiz
JOIN {course} c ON c.id = quiz.course

WHERE q.qtype = 'stack'
AND quiza.preview = 0

GROUP BY c.shortname

ORDER BY COUNT(1) DESC, c.shortname
</code></pre>
<p>Moodle has a built-in report that will count the number of questions of any type in the question bank (report/questioninstances) but I think this is a less useful statistic.</p>
<h3 id="closing-date-of-quizzes-which-use-stack">Closing date of quizzes which use STACK</h3>
<p>Another useful report, which we use for planning the time of upgrades, is this one, which lists the close date of quizzes uses STACK (including ones that use STACK questions via Moodle's 'Random question' feature:</p>
<pre><code>SELECT DISTINCT
    c.shortname AS Website,
    quiz.name AS iCMA,
    quiz.timeopen AS Open_date,
    quiz.timeclose AS Close_date

FROM {quiz} quiz
JOIN {course} c ON c.id = quiz.course

WHERE to_timestamp(quiz.timeclose) &gt; 'now'::timestamp - '1 month'::interval
AND EXISTS (
    SELECT 1
    FROM {quiz_slots} slot
    JOIN {question} q ON q.id = slot.questionid
    WHERE slot.quizid = quiz.id AND (
        q.qtype = 'stack' OR q.qtype = 'random' AND EXISTS (
            SELECT 1
            FROM {question_categories} qc
            JOIN {question} rq ON rq.category = qc.id
            WHERE qc.id = q.category AND rq.qtype = 'stack'
        )
    )
)
ORDER BY Close_date, Website, iCMA
</code></pre>
<h3 id="list-all-the-people-who-have-created-stack-questions-in-your-site">List all the people who have created STACK questions in your site</h3>
<p>One final query, which lists all the people who have created STACK questions in your site (useful if you need to email them about something:</p>
<pre><code>SELECT u.firstname, u.lastname, u.username, u.email, number_created, number_modified

FROM (
    SELECT COALESCE(createdby, modifiedby) AS userid,
           COALESCE(number_created, 0) AS number_created,
        COALESCE(number_modified, 0) AS number_modified
    FROM (

        SELECT createdby, COUNT(1) AS number_created
        FROM {question} WHERE qtype = 'stack'
        GROUP BY createdby

    ) qscreated
    FULL JOIN (

        SELECT modifiedby, COUNT(1) AS number_modified
        FROM {question} WHERE qtype = 'stack'
        GROUP BY modifiedby

    ) qsmodified ON createdby = modifiedby

) comined_counts

JOIN {user} u ON u.id = userid

ORDER BY number_created DESC, number_modified DESC
</code></pre>
<h3 id="further-queries">Further queries</h3>
<p>These queries were last updated in April 2020 (and are not actively maintained as a core part of STACK).  Please contribute related queries to the developers.</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
